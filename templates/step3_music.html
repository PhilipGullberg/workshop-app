{% extends "base.html" %}

{% block title %}Music Generation - Workshop{% endblock %}

{% block content %}

    <div class="container mx-auto p-4 text-center">
    

    <div class="mb-8 bg-gray-200 p-2 rounded-lg shadow-md flex gap-8 justify-around">
        <div class="w-2/3 gap-4 flex flex-col">
        <h2 class="text-xl font-semibold mb-2">Your Product Idea:</h2>
        {% if product_idea %}
            <p class="text-gray-700 text-left"><strong class="font-bold">Title:</strong> {{ product_idea.title }}</p>
            <p class="text-gray-700 text-left"><strong class="font-bold">Description:</strong> {{ product_idea.description }}</p>
            <p class="text-gray-700 text-left"><strong class="font-bold">Price:</strong> {{ product_idea.price }}</p>
        {% else %}
            <p class="text-red-500">Product idea not found. Please go back to Step 1.</p>
        {% endif %}
    </div>

    {% if image_data %} {# Check if image_filename exists to display the image #}
        <div class="mt-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">Generated Image:</h2>
             <!-- Display the image using the static file URL -->
            <img width="250px" src="{{ url_for('static', filename='generated_images/' + image_data) }}" alt="Generated Product Image" class="mx-auto rounded-lg shadow-lg max-w-full h-auto border border-gray-300">
        </div>
    {% endif %}
</div>
<h1 class="text-3xl font-bold mb-6">Step 3: Generate Audio for Your Product</h1>
    <form method="POST" action="{{ url_for('step3_music') }}" class="mb-6">
        <label class="block text-gray-700 text-sm font-bold mb-2">
            Select Audio Type:
        </label>
        <div class="mb-6 flex justify-center">
            <div class="mr-6">
                <input type="radio" id="audio_type_music" name="audio_type" value="music" class="mr-2 leading-tight" checked>
                <label class="text-gray-700" for="audio_type_music">
                    Music
                </label>
            </div>
            <div>
                <input type="radio" id="audio_type_voiceover" name="audio_type" value="voiceover" class="mr-2 leading-tight">
                <label class="text-gray-700" for="audio_type_voiceover">
                    Voice-over
                </label>
            </div>
        </div>

        <div class="mb-6">
            <label for="style" class="block text-gray-700 text-sm font-bold mb-2">
                Music Style (e.g., "Pop", "Rock", "Classical"):
            </label>
            <input type="text" id="style" name="style" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <label for="audio_prompt" class="block text-gray-700 text-sm font-bold mb-2">
            Enter Prompt for Audio Generation (e.g., "upbeat pop music", "friendly male voice explaining features"):
        </label>
        <textarea id="audio_prompt" name="audio_prompt" rows="4" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></textarea>

        {# Placeholder for music/voice-over specific options - will be added in Flask route logic #}

        <div class="mt-6">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md focus:outline-none focus:shadow-outline transition duration-300 ease-in-out">
                Generate Audio
            </button>
        </div>

    </form>

    {% if error_message %}
        <div class="mt-6 mb-8 text-center text-red-500 font-bold">
            <p>{{ error_message }}</p>
        </div>
    {% endif %}
    {% if suno_task_id and not audio_path %}
 <div class="mt-6 mb-8 text-center">
 <p class="text-xl text-gray-700">Generating music... Please wait. Refresh the page in 1-2 minutes.</p>
 </div>
    {% elif audio_path %} {# Use a general audio_path variable #}
        <h2>Generated Music:</h2>
        <audio controls>
            <source src="{{ audio_path }}" type="audio/mpeg"> {# Assume mpeg for now, adjust type based on generated format #}
            Your browser does not support the audio element.
        </audio>
        {# Add regenerate button here if needed #}
        <div class="mt-8">
            <a href="{{ url_for('step4_video') }}" class="inline-block px-8 py-4 text-xl font-semibold text-white bg-green-600 rounded-lg shadow-md hover:bg-green-700 transition duration-300 ease-in-out">Continue to next step</a> {# Continue button visible after generation #}
        </div>
    {% endif %}
</div>
{% endblock %}
